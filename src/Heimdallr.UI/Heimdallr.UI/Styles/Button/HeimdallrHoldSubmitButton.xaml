<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:ctrls="clr-namespace:Heimdallr.UI.Controls"
                    xmlns:cnvts="clr-namespace:Heimdallr.UI.Converters"
                    xmlns:anim="clr-namespace:Heimdallr.UI.Extensions">

  <Style TargetType="{x:Type ctrls:HeimdallrHoldSubmitButton}" BasedOn="{StaticResource {x:Type Button}}">
    <Setter Property="Width" Value="60" />
    <Setter Property="Height" Value="60" />
    <Setter Property="Cursor" Value="Hand" />
    
    <!-- 커스텀 속성-->
    <Setter Property="HoldDuration" Value="0:0:0.8" />
    <Setter Property="EllipseFill" Value="DimGray" />
    <Setter Property="BackgrounEllipseFill" Value="DodgerBlue" />
    <Setter Property="MouseOverBackground" Value="#FFE0D9D9" />
    <Setter Property="PressedBackground" Value="#FF3B9797" />
    <Setter Property="KeyboardFocusBorderBrush" Value="#FFEBD5AB" />
    <Setter Property="HoldEllipseFill" Value="DarkOrchid" />
   
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="{x:Type ctrls:HeimdallrHoldSubmitButton}">
          <Grid>
            <!-- 정중앙의 원 형태 표시용 (기본 원)-->
            <Ellipse x:Name="normalEllipse"
                     Width="{TemplateBinding Width, Converter={cnvts:HeimdallrHoldSubmitButtonConverter},
                              ConverterParameter=0.5}"
                     Height="{TemplateBinding Height, Converter={cnvts:HeimdallrHoldSubmitButtonConverter},
                              ConverterParameter=0.5}"
                     Panel.ZIndex="2"
                     Opacity="1"
                     Fill="{TemplateBinding EllipseFill}" 
                     anim:AnimationExtensions.AnimatedFill="{Binding EllipseFill, RelativeSource={RelativeSource TemplatedParent}}"/>

            <!-- 배경 확대 애니메이션용 -->
            <Ellipse x:Name="bgEllipse"
                     Width="0"
                     Height="0"
                     Panel.ZIndex="1"
                     Opacity="0.5"
                     Fill="{TemplateBinding BackgrounEllipseFill}"
                     anim:AnimationExtensions.AnimatedFill="{Binding BackgrounEllipseFill, RelativeSource={RelativeSource TemplatedParent}}"/>

            <!-- 사용자 Hold 진행 시 전면 표시용 -->
            <Ellipse x:Name="holdEllipse"
                     Height="0"
                     Panel.ZIndex="3"
                     Width="0"
                     Opacity="0.7"
                     Fill="{TemplateBinding HoldEllipseFill}"
                     anim:AnimationExtensions.AnimatedFill="{Binding HoldEllipseFill, RelativeSource={RelativeSource TemplatedParent}}"/>

            <!-- 텍스트 라벨 -->
            <ContentPresenter Width="{TemplateBinding Width, Converter={cnvts:HeimdallrHoldSubmitButtonConverter}, ConverterParameter=0.4}"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"
                              Panel.ZIndex="4"
                              Content="{TemplateBinding Content}" />

            <!-- 마우스 눌렀을 때 애니메이션 트리거 -->
            <Grid.Triggers>
              <EventTrigger RoutedEvent="MouseLeftButtonDown">
                <BeginStoryboard>
                  <Storyboard>
                    <!-- 배경 원 확대 -->
                    <DoubleAnimation Storyboard.TargetName="bgEllipse" Storyboard.TargetProperty="Width"
                                     From="{Binding Width, ElementName=normalEllipse}"
                                     To="{Binding Width, RelativeSource={RelativeSource TemplatedParent}}"
                                     Duration="0:0:0.25" />
                    <DoubleAnimation Storyboard.TargetName="bgEllipse"
                                     Storyboard.TargetProperty="Height"
                                     From="{Binding Height, ElementName=normalEllipse}"
                                     To="{Binding Height, RelativeSource={RelativeSource TemplatedParent}}"
                                     Duration="0:0:0.25" />

                    <!-- hold 진행용 원 (딜레이 후) -->
                    <DoubleAnimation AccelerationRatio="0.6"
                                     BeginTime="0:0:0.4"
                                     Storyboard.TargetName="holdEllipse"
                                     Storyboard.TargetProperty="Width"
                                     From="{Binding Width, ElementName=normalEllipse}"
                                     To="{Binding Width, RelativeSource={RelativeSource TemplatedParent}}"
                                     Duration="{Binding HoldDuration, RelativeSource={RelativeSource TemplatedParent},
                                                    Converter={cnvts:HeimdallrHoldSubmitButtonDurationSecondsSubtractionConverter}, ConverterParameter=0.4}" />
                    <DoubleAnimation AccelerationRatio="0.6"
                                     BeginTime="0:0:0.4"
                                     Storyboard.TargetName="holdEllipse"
                                     Storyboard.TargetProperty="Height"
                                     From="{Binding Height, ElementName=normalEllipse}"
                                     To="{Binding Height, RelativeSource={RelativeSource TemplatedParent}}"
                                     Duration="{Binding HoldDuration, RelativeSource={RelativeSource TemplatedParent},
                                       Converter={cnvts:HeimdallrHoldSubmitButtonDurationSecondsSubtractionConverter}, ConverterParameter=0.4}" />
                  </Storyboard>
                </BeginStoryboard>
              </EventTrigger>
            </Grid.Triggers>
          </Grid>

          <!-- Hold 완료/취소 시 원형 되돌리는 스토리보드 -->
          <ControlTemplate.Resources>
            <Storyboard x:Key="RestoreStoryboard">
              <DoubleAnimation Storyboard.TargetName="bgEllipse" Storyboard.TargetProperty="Width"
                               To="0" Duration="0:0:0.25" />
              <DoubleAnimation Storyboard.TargetName="bgEllipse" Storyboard.TargetProperty="Height"
                               To="0" Duration="0:0:0.25" />
              <DoubleAnimation Storyboard.TargetName="holdEllipse" Storyboard.TargetProperty="Width"
                               To="0" Duration="0:0:0.25" />
              <DoubleAnimation Storyboard.TargetName="holdEllipse" Storyboard.TargetProperty="Height"
                               To="0" Duration="0:0:0.25" />
            </Storyboard>
          </ControlTemplate.Resources>
          <ControlTemplate.Triggers>
            <EventTrigger RoutedEvent="HoldCompleted">
              <BeginStoryboard Storyboard="{StaticResource RestoreStoryboard}" />
            </EventTrigger>
            <EventTrigger RoutedEvent="HoldCancelled">
              <BeginStoryboard Storyboard="{StaticResource RestoreStoryboard}" />
            </EventTrigger>

            <!-- 마우스 오버 시 색상 변경 -->
            <Trigger Property="IsMouseOver" Value="True">
              <Setter TargetName="normalEllipse" Property="anim:AnimationExtensions.AnimatedFill" 
                      Value="{Binding MouseOverBackground, RelativeSource={RelativeSource TemplatedParent}}" />
            </Trigger>

            <!-- 마우스 클릭(Pressed) 시 색상 변경 -->
            <Trigger Property="IsPressed" Value="True">
              <Setter TargetName="normalEllipse" Property="anim:AnimationExtensions.AnimatedFill" 
                      Value="{Binding PressedBackground, RelativeSource={RelativeSource TemplatedParent}}" />
            </Trigger>

            <!-- 키보드 포커스 시 테두리 표시 -->
            <Trigger Property="IsKeyboardFocused" Value="True">
              <Setter TargetName="normalEllipse" Property="Stroke" 
                      Value="{Binding KeyboardFocusBorderBrush, RelativeSource={RelativeSource TemplatedParent}}" />
            </Trigger>
          </ControlTemplate.Triggers>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>
</ResourceDictionary>


