<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cnvts="clr-namespace:Heimdallr.UI.Converters"
    xmlns:ctrls="clr-namespace:Heimdallr.UI.Controls"
    xmlns:enums="clr-namespace:Heimdallr.UI.Enums">

  <Style x:Key="FlatToggleButtonStyle" TargetType="ToggleButton">
    <Setter Property="Background" Value="Transparent"/>
    <Setter Property="BorderBrush" Value="Transparent"/>
    <Setter Property="BorderThickness" Value="0"/>
    <Setter Property="Padding" Value="0"/>
    <Setter Property="Cursor" Value="Hand" />
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="ToggleButton">
          <ContentPresenter
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"/>
          <!--RecognizesAccessKey="True" ContentPresenter 제외 -->
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>

  <Style TargetType="{x:Type ctrls:HeimdallrTreeViewItem}"
         BasedOn="{StaticResource {x:Type TreeViewItem}}">
    <Setter Property="Background" Value="Transparent" />
    <Setter Property="IconFill" Value="#FFD3DAD9" />
    <Setter Property="IconSize" Value="30" />
    
    <!-- 커스텀 속성-->
    <Setter Property="ExpandIcon" Value="Arrow_Ellipse_DownA" />
    <Setter Property="CollapseIcon" Value="Arrow_Ellipse_UpA" />
    <Setter Property="ExpandToggleIconSize" Value="25" />
    <Setter Property="ExpandIconFill" Value="#FFE0D9D9" />
    <Setter Property="CollapseIconFill" Value="#FFD2C1B6" />
    <Setter Property="Foreground" Value="#FFDCD7C9" />
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="{x:Type ctrls:HeimdallrTreeViewItem}">
          <StackPanel>
            <!-- Header 영역 -->
            <Border
                x:Name="border"
                Background="{TemplateBinding Background}"
                BorderBrush="{TemplateBinding BorderBrush}"
                BorderThickness="{TemplateBinding BorderThickness}"
                SnapsToDevicePixels="True"
                Padding="3"
                Margin="{Binding RelativeSource={RelativeSource TemplatedParent}, 
                            Converter={cnvts:HeimdallrTreeViewDepthConverter}}">

              <Grid>
                <Grid.ColumnDefinitions>
                  <!-- 아이콘이미지 -->
                  <ColumnDefinition Width="Auto" />

                  <!-- 문자열 -->
                  <ColumnDefinition Width="*" />

                  <!-- ToggleButton -->
                  <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- PathIcon -->
                <Viewbox Grid.Column="0"
                         Stretch="Uniform"
                         Width="{Binding IconSize, RelativeSource={RelativeSource TemplatedParent}}"
                         Height="{Binding IconSize, RelativeSource={RelativeSource TemplatedParent}}">
                  <ctrls:HeimdallrIcon 
                          Grid.Column="0"
                          Icon="{Binding Icon, RelativeSource={RelativeSource TemplatedParent}}"
                          Fill="{Binding IconFill, RelativeSource={RelativeSource TemplatedParent}}"
                          Visibility="{Binding Icon, RelativeSource={RelativeSource TemplatedParent}, 
                                        Converter={cnvts:IconToVisibilityConverter}}" />
                </Viewbox>

                <!-- 문자열 -->
                <TextBlock 
                      Grid.Column="1"
                      Text="{TemplateBinding Text}"
                      VerticalAlignment= "Center" 
                      Margin="10 0 0 0"
                      Padding="2" 
                      Visibility="{Binding Text, RelativeSource={RelativeSource TemplatedParent},
                                     Converter={cnvts:NullOrEmptyToVisibilityConverter}}"/>

                <!-- ✔ 문자열 없을 때 간격 유지를 위한 Dummy Spacer -->
                <Border 
                      Grid.Column="1"
                      Background="Transparent"
                      Visibility="{Binding Text, RelativeSource={RelativeSource TemplatedParent},
                                   Converter={cnvts:NullOrEmptyToVisibilityConverter}, ConverterParameter=invert}"
                      Margin="{Binding IconSpacingWhenTextIsEmpty, RelativeSource={RelativeSource TemplatedParent}, 
                                   Converter={cnvts:DoubleToLeftMarginConverter}}" />

                <!-- 펼침 접힘 아이콘 -->
                <ToggleButton 
                      Grid.Column="2"
                      IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}}"
                      Style="{StaticResource FlatToggleButtonStyle}"
                      VerticalAlignment="Center" 
                      Margin="10 0 0 0">

                  <Border Background="Transparent" MinWidth="24" MinHeight="24">
                    <Grid>
                      <Viewbox
                            Stretch="Uniform"
                            Width="{Binding ExpandToggleIconSize, RelativeSource={RelativeSource TemplatedParent}}"
                            Height="{Binding ExpandToggleIconSize, RelativeSource={RelativeSource TemplatedParent}}">
                        <ctrls:HeimdallrIcon
                                x:Name="ExpandIconElement"
                                Icon="{Binding ExpandIcon, RelativeSource={RelativeSource TemplatedParent}}"
                                Fill="{Binding ExpandIconFill, RelativeSource={RelativeSource TemplatedParent}}"
                                Visibility="Collapsed"/>
                      </Viewbox>
                      <Viewbox
                            Stretch="Uniform"
                            Width="{Binding ExpandToggleIconSize, RelativeSource={RelativeSource TemplatedParent}}"
                            Height="{Binding ExpandToggleIconSize, RelativeSource={RelativeSource TemplatedParent}}">
                        <ctrls:HeimdallrIcon
                                x:Name="CollapseIconElement"
                                Icon="{Binding CollapseIcon, RelativeSource={RelativeSource TemplatedParent}}"
                                Fill="{Binding CollapseIconFill, RelativeSource={RelativeSource TemplatedParent}}"
                                Visibility="Collapsed"/>
                      </Viewbox>
                    </Grid>
                  </Border>
                </ToggleButton>
              </Grid>
            </Border>
            <ItemsPresenter x:Name="itemsHost"
                            Margin="0 2 0 0"
                            Visibility="Collapsed" />
          </StackPanel>

          <ControlTemplate.Triggers>
            <!-- 확장 트리거 -->
            <Trigger Property="IsExpanded" Value="True">
              <Setter TargetName="itemsHost" Property="Visibility" Value="Visible" />
              <Setter TargetName="ExpandIconElement" Property="Visibility" Value="Visible" />
              <Setter TargetName="CollapseIconElement" Property="Visibility" Value="Collapsed" />
            </Trigger>

            <Trigger Property="IsExpanded" Value="False">
              <Setter TargetName="ExpandIconElement" Property="Visibility" Value="Collapsed" />
              <Setter TargetName="CollapseIconElement" Property="Visibility" Value="Visible" />
            </Trigger>

            <!-- 선택 및 마우스 오버 스타일 -->
            <Trigger Property="IsSelected" Value="True">
              <Setter TargetName="border" Property="Background" 
                      Value="{Binding SelectedBackground, RelativeSource={RelativeSource TemplatedParent}}"/>
            </Trigger>
            <Trigger Property="IsMouseOver" Value="True">
              <Setter TargetName="border" Property="Background" 
                      Value="{Binding HoverBackground, RelativeSource={RelativeSource TemplatedParent}}"/>
            </Trigger>
          </ControlTemplate.Triggers>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>
</ResourceDictionary>
